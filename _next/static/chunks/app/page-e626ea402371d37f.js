(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8095:function(e,t,a){Promise.resolve().then(a.bind(a,2522))},7568:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=a(4981);a(5320),a(8978);let s=n._(a(6080));function r(e,t){var a;let n={loading:e=>{let{error:t,isLoading:a,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let r={...n,...t};return(0,s.default)({...r,modules:null==(a=r.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7208:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=a(8165);function s(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return a}},6080:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let n=a(5320),s=a(8978),r=a(7208),i=a(7893);function l(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},c=function(e){let t={...o,...e},a=(0,s.lazy)(()=>t.loader().then(l)),c=t.loading;function p(e){let l=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(i.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(s.Suspense,{fallback:l,children:o})}return p.displayName="LoadableComponent",p}},7893:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return r}});let n=a(5320),s=a(6334);function r(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,s.getExpectedRequestStore)("next/dynamic css"),r=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));r.push(...t)}}return 0===r.length?null:(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},2522:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var n=a(5320),s=a(8978),r=a(7568),i=a.n(r),l=a(5452),o=a(8439);let c=[{type:"impl",name:"actions__ContractImpl",interface_name:"dojo::contract::interface::IContract"},{type:"interface",name:"dojo::contract::interface::IContract",items:[]},{type:"impl",name:"actions__DeployedContractImpl",interface_name:"dojo::meta::interface::IDeployedResource"},{type:"struct",name:"core::byte_array::ByteArray",members:[{name:"data",type:"core::array::Array::<core::bytes_31::bytes31>"},{name:"pending_word",type:"core::felt252"},{name:"pending_word_len",type:"core::integer::u32"}]},{type:"interface",name:"dojo::meta::interface::IDeployedResource",items:[{type:"function",name:"dojo_name",inputs:[],outputs:[{type:"core::byte_array::ByteArray"}],state_mutability:"view"}]},{type:"impl",name:"ActionsImpl",interface_name:"puppet_vs_gizmo::systems::actions::IActions"},{type:"interface",name:"puppet_vs_gizmo::systems::actions::IActions",items:[{type:"function",name:"create_game",inputs:[{name:"character",type:"core::integer::u8"},{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{type:"function",name:"join_game",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{type:"function",name:"throw",inputs:[{name:"game_id",type:"core::integer::u32"},{name:"power",type:"core::integer::u8"}],outputs:[],state_mutability:"external"},{type:"function",name:"player_health",inputs:[{name:"address",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{type:"function",name:"game_winner",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{type:"function",name:"get_first_player",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"},{type:"function",name:"get_second_player",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"},{type:"function",name:"get_game_turn",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"}]},{type:"function",name:"dojo_init",inputs:[],outputs:[],state_mutability:"view"},{type:"impl",name:"WorldProviderImpl",interface_name:"dojo::contract::components::world_provider::IWorldProvider"},{type:"struct",name:"dojo::world::iworld::IWorldDispatcher",members:[{name:"contract_address",type:"core::starknet::contract_address::ContractAddress"}]},{type:"interface",name:"dojo::contract::components::world_provider::IWorldProvider",items:[{type:"function",name:"world_dispatcher",inputs:[],outputs:[{type:"dojo::world::iworld::IWorldDispatcher"}],state_mutability:"view"}]},{type:"impl",name:"UpgradeableImpl",interface_name:"dojo::contract::components::upgradeable::IUpgradeable"},{type:"interface",name:"dojo::contract::components::upgradeable::IUpgradeable",items:[{type:"function",name:"upgrade",inputs:[{name:"new_class_hash",type:"core::starknet::class_hash::ClassHash"}],outputs:[],state_mutability:"external"}]},{type:"constructor",name:"constructor",inputs:[]},{type:"event",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded",kind:"struct",members:[{name:"class_hash",type:"core::starknet::class_hash::ClassHash",kind:"data"}]},{type:"event",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Event",kind:"enum",variants:[{name:"Upgraded",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded",kind:"nested"}]},{type:"event",name:"dojo::contract::components::world_provider::world_provider_cpt::Event",kind:"enum",variants:[]},{type:"event",name:"puppet_vs_gizmo::systems::actions::actions::Event",kind:"enum",variants:[{name:"UpgradeableEvent",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Event",kind:"nested"},{name:"WorldProviderEvent",type:"dojo::contract::components::world_provider::world_provider_cpt::Event",kind:"nested"}]}];var p={src:"/Puppet//_next/static/media/puppet_preview.82f41b7d.png"},h={src:"/Puppet//_next/static/media/gizmo_preview.1253c5ed.png"},u={src:"/Puppet//_next/static/media/versus.b298df6b.png"},d={src:"/Puppet//_next/static/media/back.33c5057d.png"},m={src:"/Puppet//_next/static/media/small_puppet.9a537536.png"},f={src:"/Puppet//_next/static/media/small_gizmo.c7725c5d.png"},g={src:"/Puppet//_next/static/media/select.be584483.png"},_=a(9767);function y(e){let{player1Hp:t,player2Hp:a,throwStone:r,gameId:i,getGameTurn:l,getFirstPlayer:o,getSecondPlayer:c,getPlayerHealth:p,userAddress:h,isPlayer1:u}=e;return(0,s.useEffect)(()=>{let e=document.getElementById("gameCanvas"),n=null==e?void 0:e.getContext("2d",{alpha:!1});if(e.width=1280,e.height=522,null===t||null===a)return;let s={x:15,y:e.height-350,width:256,height:316,hitboxHeight:316/6,hp:t,maxHp:100},o={x:e.width-290,y:e.height-350,width:256,height:316,hitboxHeight:316/6,hp:a,maxHp:100},c=performance.now(),d=!1,m=null;(async()=>{1!==(m=await l(i))||u?2===m&&u&&er():er()})();let f=!0,g=null,_=!1,y=0,b={x:543,y:315,width:187.5,height:180},w=["https://klanfontan.github.io/assets/puppet_frames_death/frame_00.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_01.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_02.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_03.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_04.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_05.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_06.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_07.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_08.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_09.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_10.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_11.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_12.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_13.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_14.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_15.png"],x=["https://klanfontan.github.io/assets/gizmo_frames_death/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_11.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_12.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_13.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_14.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_15.png"],k=[],v=[],j=new Image;j.src="https://klanfontan.github.io/game/Puppet-main/gamecode/background.png";let P=new Image;P.src="https://klanfontan.github.io/game/Puppet-main/gamecode/emptyHpBar.png";let E=new Image;E.src="https://klanfontan.github.io/assets/puppet_frames/frame_00.png";let C=new Image;C.src="https://klanfontan.github.io/assets/gizmo_frames/frame_00.png";let N=new Image;N.src="https://klanfontan.github.io/game/Puppet-main/gamecode/backButton.png";let A={x:50,y:55,width:125,height:45},I=new Image;I.src="https://klanfontan.github.io/img/versus.svg";let F=new Image;F.src="https://klanfontan.github.io/img/square_gizmo.png";let z=new Image;z.src="https://klanfontan.github.io/img/square_puppet.png";let S="Gizmo",T=s.hp,O=o.hp,M=!1,R=!1,L=0,B=0;function D(){B=12*Math.random()-6}function G(e,t,a,s,r){n&&(n.beginPath(),n.moveTo(e,t),n.lineTo(e+a,t-r/2),n.lineTo(e+a,t+r/2),n.closePath(),n.fill(),"#FFFFFF"!==n.fillStyle&&(n.lineWidth=2,n.strokeStyle="#FFFFFF",n.stroke()))}let U=document.createElement("canvas"),Y=U.getContext("2d");function q(){n&&n.drawImage(U,0,0)}U.width=e.width,U.height=e.height;let X=0,H=0,W=0,V=0;function Z(e){let t=!el&&(e===s&&M||e===o&&R),a=Date.now()-L;if(t&&a<500){if(!n)return;n.globalAlpha=Math.floor(a/100)%2==0?.5:1}else{if(e===s&&(M=!1),e===o&&(R=!1),!n)return;n.globalAlpha=1}e===s?n.drawImage(E,e.x,e.y,e.width,e.height):n.drawImage(C,e.x,e.y,e.width,e.height);let r=performance.now();if(r-ef>50&&(em=(em+1)%ed.length,ef=r),e===s){if(W>0){let e=r-W;e<1e3?X=1-e/1e3:(X=0,W=0)}n.globalAlpha=X}else{if(V>0){let e=r-V;e<1e3?H=1-e/1e3:(H=0,V=0)}n.globalAlpha=H}let i=e.x+(e.width-125)/2,l=e.y-31.25+60;n.drawImage(ed[em],i,l,125,125),n.globalAlpha=1}function J(){let t=e.width-350-150;if(!n)return;n.fillStyle="white",n.font="28px Fortnite",n.textAlign="right",n.shadowColor="rgba(100, 13, 13, 1)",n.shadowOffsetX=0,n.shadowOffsetY=4,n.fillText(S,460,45),n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillStyle="rgba(232, 44, 64, 1)";let a=e.width/2-n.measureText(S).width-260;Q(a,29,70,30,5),n.fillStyle="white",n.font="18px Fortnite",n.textAlign="center",n.shadowColor="rgba(0, 0, 0, 0.1)",n.shadowOffsetX=0,n.shadowOffsetY=3,n.fillText("PUPPET",a+35,46),n.shadowOffsetX=0,n.shadowOffsetY=0,null!==T&&null!==s.hp&&T>s.hp&&(T-=.5)<s.hp&&(T=s.hp),n.fillStyle="white",Q(150,70,350,12,6),n.fillStyle="red",null!==T&&T>0&&Q(152,72,T/s.maxHp*346,8,4),n.fillStyle="white",n.font="28px Fortnite",n.textAlign="left",n.shadowColor="rgba(100, 13, 13, 1)",n.shadowOffsetX=0,n.shadowOffsetY=4,n.fillText(S,e.width-460,45),n.shadowOffsetX=0,n.shadowOffsetY=0,n.fillStyle="rgba(137, 223, 111, 1)";let r=n.measureText(S).width,i=e.width/2+r+190;Q(i,29,70,30,5),n.fillStyle="white",n.font="18px Fortnite",n.textAlign="center",n.shadowColor="rgba(0, 0, 0, 0.1)",n.shadowOffsetX=0,n.shadowOffsetY=3,n.fillText("GIZMO",i+35,46),n.shadowOffsetX=0,n.shadowOffsetY=0,null!==O&&null!==o.hp&&O>o.hp&&(O-=.5)<o.hp&&(O=o.hp),n.fillStyle="white",Q(t,70,350,12,6),n.fillStyle="red",null!==O&&O>0&&Q(t+2+346*(1-O/o.maxHp),72,O/o.maxHp*346,8,4)}function Q(e,t,a,s,r){n&&(n.beginPath(),n.moveTo(e+r,t),n.lineTo(e+a-r,t),n.quadraticCurveTo(e+a,t,e+a,t+r),n.lineTo(e+a,t+s-r),n.quadraticCurveTo(e+a,t+s,e+a-r,t+s),n.lineTo(e+r,t+s),n.quadraticCurveTo(e,t+s,e,t+s-r),n.lineTo(e,t+r),n.quadraticCurveTo(e,t,e+r,t),n.closePath(),n.fill())}function K(){m=1===m?2:1,f=!0,D()}e.addEventListener("mousedown",e=>{f&&!g&&(u?1===m:2===m)&&(_=!0,eg=!0)}),e.addEventListener("mouseup",e=>{_&&f&&(u?1===m:2===m)&&(_=!1,eg=!1,en())});let $=["https://klanfontan.github.io/assets/puppet_frames/frame_00.png","https://klanfontan.github.io/assets/puppet_frames/frame_01.png","https://klanfontan.github.io/assets/puppet_frames/frame_02.png","https://klanfontan.github.io/assets/puppet_frames/frame_03.png","https://klanfontan.github.io/assets/puppet_frames/frame_04.png","https://klanfontan.github.io/assets/puppet_frames/frame_05.png","https://klanfontan.github.io/assets/puppet_frames/frame_06.png","https://klanfontan.github.io/assets/puppet_frames/frame_07.png","https://klanfontan.github.io/assets/puppet_frames/frame_08.png","https://klanfontan.github.io/assets/puppet_frames/frame_09.png","https://klanfontan.github.io/assets/puppet_frames/frame_10.png","https://klanfontan.github.io/assets/puppet_frames/frame_11.png"],ee=["https://klanfontan.github.io/assets/gizmo_frames/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames/frame_11.png"],et=0;function ea(e){return Promise.all(e.map(e=>new Promise((t,a)=>{let n=new Image;n.src=e,n.onload=t,n.onerror=a})))}function en(){let e;let t=.5*B,a=3.2+y;1===m?(e=es($,E,"https://klanfontan.github.io/assets/puppet_frames/frame_00.png"),g={x:s.x+s.width-210,y:s.y+s.height/2+20,speedX:a+t,speedY:-(1.5*a)}):(e=es(ee,C,"https://klanfontan.github.io/assets/gizmo_frames/frame_00.png"),g={x:o.x+210,y:o.y+o.height/2+20,speedX:-a+t,speedY:-(1.5*a)}),y=0,f=!1,setTimeout(()=>{e()},350)}function es(e,t,a){et=0;let n=performance.now(),s=!0;return requestAnimationFrame(function a(r){s&&(r-n>=25&&(t.src=e[et],et=(et+1)%e.length,n=r),requestAnimationFrame(a))}),function(){s=!1,t.src=a}}async function er(){setTimeout(async()=>{let e=await l(i);if(u&&1===e||!u&&2===e){let e=await p(null!=h?h:"");h&&null!==e&&null!==s.hp&&e<s.hp&&u?(eg=!0,setTimeout(()=>{if(eg=!1,en(),g){let e=o.x+o.width/2,t=o.y+o.height/2,a=performance.now(),n=s=>{let r=Math.min((s-a)/500,1);g&&(g.x=g.x+(e-g.x)*r,g.y=g.y+(t-g.y)*r),r<1?requestAnimationFrame(n):null!==o.hp&&(o.hp-=15)};requestAnimationFrame(n)}},800*Math.random()+400)):h&&null!==e&&null!==o.hp&&e<o.hp&&!u?(eg=!0,setTimeout(()=>{if(eg=!1,en(),g){let e=s.x+s.width/2,t=s.y+s.height/2,a=performance.now(),n=r=>{let i=Math.min((r-a)/500,1);g&&(g.x=g.x+(e-g.x)*i,g.y=g.y+(t-g.y)*i),i<1?requestAnimationFrame(n):null!==s.hp&&(s.hp-=15)};requestAnimationFrame(n)}},800*Math.random()+400)):(eg=!0,setTimeout(()=>{eg=!1,en()},2200*Math.random()+1400))}else er()},2e4)}async function ei(t){g&&(g.x+=g.speedX*t*100,g.y+=g.speedY*t*100,g.speedY+=.17*t*100,(g.x>e.width||g.x<0||g.y>e.height)&&(g=null,(1===m&&u||2===m&&!u)&&(await r(i,3),er()),K()))}Promise.all([ea($),ea(ee)]).then(()=>{ec()}).catch(e=>{console.error("Ошибка загрузки кадров:",e)});let el=!1,eo=!0;function ec(){let t,a,l,p,h;if(eo)return;let _=performance.now(),w=(_-c)/1e3;c=_,n&&(n.clearRect(0,0,e.width,e.height),q(),eg&&y<8&&f&&(y+=6*w),ei(w),function(){if(g){var t,a,l,c,p,h,f,_;if(g.x>=b.x&&g.x<=b.x+b.width&&g.y>=b.y&&g.y<=b.y+b.height||(t=g.x,a=g.y,l=b.x,c=b.y,p=b.x+b.width/2,h=b.y-80,f=b.x+b.width,.1>Math.abs(Math.abs((p-l)*((_=b.y)-c)-(f-l)*(h-c))/2-(Math.abs((l-t)*(h-a)-(p-t)*(c-a))/2+Math.abs((p-t)*(_-a)-(f-t)*(h-a))/2+Math.abs((f-t)*(c-a)-(l-t)*(_-a))/2)))){g=null,r(i,2),K(),er();return}let y=1===m?o:s,w=y.y+(y.height-y.hitboxHeight)/2,x=Math.max(y.x,Math.min(g.x,y.x+y.width)),j=Math.max(w,Math.min(g.y,w+y.hitboxHeight));if(10>=Math.sqrt((g.x-x)**2+(g.y-j)**2)){if(null!==y.hp&&y.hp<=0&&(y.hp=0,y.height=y.height/1.5,y.y=e.height-y.height-34),g=null,y===o?(R=!0,V=performance.now()):(M=!0,W=performance.now()),L=Date.now(),(!u&&y===s||u&&y===o)&&(null!==y.hp&&(y.hp-=15),r(i,1),er()),null!==y.hp&&y.hp<=0&&!d){el=!0,d=!0;let t=1===m?"Puppet":"Gizmo",a=1===m?2:1;if(M=!1,R=!1,!n)return;n.globalAlpha=1,cancelAnimationFrame(ec),function(t,a){console.log("Starting death animation for player",t);let r=0,i=0,l=1===t?k:v;if(0===l.length){console.error("No death animation frames loaded!"),a&&a();return}!function c(){if(r>=l.length){if(++i<6){r=0,requestAnimationFrame(()=>setTimeout(c,25));return}console.log("Animation complete after",6,"plays"),a&&a();return}(1===t?E:C).src=l[r].src,n&&(n.clearRect(0,0,e.width,e.height),q(),Z(s),Z(o),J(),r++,requestAnimationFrame(()=>setTimeout(c,25)))}()}(a,()=>{setTimeout(()=>{(function(t){el=!0;let a="Puppet"===t?"#E82C40":"#89DF6F",s=0,r=10,i=Date.now();ep=!0,function l(){let o=Math.min((Date.now()-i)/2e3,1),c=o<.5?2*o*o:-1+(4-2*o)*o;s=c,r=10+38*c,n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgba(".concat(parseInt(a.slice(1,3),16),", ").concat(parseInt(a.slice(3,5),16),", ").concat(parseInt(a.slice(5,7),16),", ").concat(s,")"),n.fillRect(0,0,e.width,e.height),n.fillStyle="rgba(255, 255, 255, ".concat(s,")"),n.font="".concat(r,"px Fortnite"),n.textAlign="center",n.textBaseline="middle",n.fillText("Game Over! ".concat(t," wins!"),e.width/2,e.height/2),ep&&(n.globalAlpha=s,n.drawImage(N,A.x,A.y,A.width,A.height),n.globalAlpha=1),o<1&&requestAnimationFrame(l))}()})(t)},0)})}else K()}}}(),n.globalAlpha=1,Z(s),Z(o),g&&g&&n&&(n.fillStyle="gray",n.beginPath(),n.arc(g.x,g.y,10,0,2*Math.PI),n.fill()),(el||d)&&(ek=Math.max(0,ek-.05)),n.globalAlpha=ek,J(),ex.forEach((e,t)=>{if(!e.used){if(1===t)n&&(n.save(),n.translate(e.x+e.width/2,e.y+e.height/2),n.scale(-1,1),n.drawImage(ew,-e.width/2,-e.height/2,e.width,e.height),n.restore());else{if(!n)return;n.drawImage(ew,e.x,e.y,e.width,e.height)}}}),function(){let t=(e.width-200)/2;if(!n)return;n.shadowColor="#03043E",n.shadowOffsetX=0,n.shadowOffsetY=4,n.shadowBlur=0,n.fillStyle="#B3B4FE",n.fillRect(t,125,200,40),n.shadowColor="transparent",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0;let a=Math.max(-6,Math.min(6,B));n.fillStyle="#FFFFFF",n.fillRect(t+100,125,a/6*100,40),n.fillStyle="#0003FA",n.font="28px Fortnite",n.textAlign="center",n.fillText("Wind",e.width/2,146),n.fillStyle=a<0?"#FFFFFF":"#B3B4FE",G(t-20-35,145,40,0,20),n.fillStyle=a>0?"#FFFFFF":"#B3B4FE",G(t+200+20+35,145,-40,0,20)}(),eb(n),el||ey(n),f&&n&&(1===m?(t=s.x+s.width/1.55,a=s.y+150,p=(l=5*Math.PI/4+Math.PI-Math.PI/6)-y/8*(h=.85*Math.PI)):(t=o.x+o.width/2.5,a=o.y+150,p=(l=3*Math.PI/4+Math.PI/6)+y/8*(h=.85*Math.PI)),n.beginPath(),n.strokeStyle="rgba(255, 255, 255, 0.3)",n.lineWidth=30,n.arc(t,a,125,l,l+(1===m?-h:h),1===m),n.stroke(),eg&&(n.beginPath(),n.strokeStyle="white",n.lineWidth=30,n.arc(t,a,125,l,p,1===m),n.stroke())),n.globalAlpha=1,el&&null===g||requestAnimationFrame(ec))}let ep=!1,eh=3,eu=["https://klanfontan.github.io/assets/gizmo_stars/frame_00.png","https://klanfontan.github.io/assets/gizmo_stars/frame_01.png","https://klanfontan.github.io/assets/gizmo_stars/frame_02.png","https://klanfontan.github.io/assets/gizmo_stars/frame_03.png","https://klanfontan.github.io/assets/gizmo_stars/frame_04.png","https://klanfontan.github.io/assets/gizmo_stars/frame_05.png","https://klanfontan.github.io/assets/gizmo_stars/frame_06.png","https://klanfontan.github.io/assets/gizmo_stars/frame_07.png","https://klanfontan.github.io/assets/gizmo_stars/frame_08.png","https://klanfontan.github.io/assets/gizmo_stars/frame_09.png","https://klanfontan.github.io/assets/gizmo_stars/frame_10.png"],ed=[],em=0,ef=0;Promise.all([new Promise(e=>j.onload=e),new Promise(e=>P.onload=e),new Promise(e=>E.onload=e),new Promise(e=>C.onload=e)]).then(()=>{(function(){let e=0,t=w.length+x.length;function a(){e++,console.log("Loaded ".concat(e,"/").concat(t," death frames"))}w.forEach(e=>{let t=new Image;t.onload=a,t.src=e,k.push(t)}),x.forEach(e=>{let t=new Image;t.onload=a,t.src=e,v.push(t)})})(),eu.forEach(e=>{let t=new Image;t.src=e,ed.push(t)}),Y&&(Y&&Y.drawImage(j,0,0,e.width,e.height),eb(Y),ey(Y)),D(),function t(){n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgba(232, 44, 64, 1)",n.fillRect(0,0,e.width,e.height),n.fillStyle="white",n.font="100px Fortnite",n.textAlign="center",n.textBaseline="middle",n.fillText(eh.toString(),e.width/2,e.height/2),eh>1?(eh--,setTimeout(t,1e3)):setTimeout(()=>{eh=3,eo=!1,ec()},1e3))}()}),e.addEventListener("click",t=>{if(ep){let a=e.getBoundingClientRect(),n=t.clientX-a.left,s=t.clientY-a.top;n>=A.x&&n<=A.x+A.width&&s>=A.y&&s<=A.y+A.height&&(ep=!1)}});let eg=!1;function e_(t,a){let n=e.getBoundingClientRect();return t>=n.left&&t<=n.right&&a>=n.top&&a<=n.bottom}function ey(t){let a=e.width/2;t.drawImage(I,a-37.5,30,75,63)}function eb(t){let a=e.width/2+100-30,n=e.width/2-100-65;t.drawImage(F,a,10,100,100),t.drawImage(z,n,10,100,100)}e.addEventListener("touchstart",t=>{let a=t.changedTouches[0],n=a.clientX,s=a.clientY;if(ep&&(e.getBoundingClientRect(),n>=A.x&&n<=A.x+A.width&&s>=A.y&&s<=A.y+A.height)){window.location.href="../../../index.html";return}let r=!1;if(ex.forEach((e,t)=>{if(!e.used&&n>=e.x&&n<=e.x+e.width&&s>=e.y&&s<=e.y+e.height){r=!0;return}}),!r&&e_(n,s)){if(t.preventDefault(),1!==m)return;!f||g||1!==m||(eg=!0)}}),e.addEventListener("touchend",e=>{let t=e.changedTouches[0];if(e_(t.clientX,t.clientY)){if(e.preventDefault(),1!==m)return;eg&&(eg=!1,en())}}),e.addEventListener("touchmove",e=>{e.preventDefault()}),new FontFace("Fortnite","url(https://klanfontan.github.io/game/Puppet-main/gamecode/frt.otf)").load().then(function(e){document.fonts.add(e),n&&(n.font="48px Fortnite")}).catch(function(e){console.error("Ошибка загрузки шрифта:",e)});let ew=new Image;ew.src="https://klanfontan.github.io/game/Puppet-main/gamecode/potion.png";let ex=[{x:65,y:35,width:50,height:70,used:!1},{x:e.width-115,y:35,width:50,height:70,used:!1}];e.addEventListener("click",t=>{t.preventDefault();let a=e.getBoundingClientRect(),n=t.clientX-a.left,s=t.clientY-a.top;ex.forEach((e,t)=>{!e.used&&n>=e.x&&n<=e.x+e.width&&s>=e.y&&(e.y,e.height)})});let ek=1},[]),(0,n.jsx)("canvas",{id:"gameCanvas",width:"1280",height:"522"})}i()(()=>a.e(959).then(a.bind(a,2959)),{loadableGenerated:{webpack:()=>[2959]},ssr:!1});var b=()=>{let{data:e,isLoading:t,isError:a}=(0,l.Ov)({blockIdentifier:"latest"}),{connect:r,connectors:i}=(0,l.$4)(),{disconnect:b}=(0,l.qL)(),[w,x]=(0,s.useState)(!0),[k,v]=(0,s.useState)(!1),[j,P]=(0,s.useState)(!1),[E,C]=(0,s.useState)(null),[N,A]=(0,s.useState)(!1),[I,F]=(0,s.useState)(0),[z,S]=(0,s.useState)(1),[T,O]=(0,s.useState)(!1),[M,R]=(0,s.useState)(),[L,B]=(0,s.useState)(!1),[D,G]=(0,s.useState)(null),[U,Y]=(0,s.useState)(null),[q,X]=(0,s.useState)(null),H=async()=>{if(ea&&W)try{if(await ej(I)!=W&&await ev(I)==W||await ev(I)!=W&&await ej(I)==W){B(!0);return}await ew(I)&&B(!0)}catch(e){console.error("Error sending transaction:",e)}},{address:W}=(0,l.mA)(),{account:V}=(0,l.mA)(),{isLoading:Z,isError:J,error:Q,data:K}=(0,l.KQ)({address:W,watch:!0}),$="0x0409f17fbe2145d007c6d18731fa9919e943a60230fe5c2647f702615a49e4f9",[ee,et]=(0,s.useState)(0),{contract:ea}=(0,l.cq)({abi:c,address:$}),en=(0,s.useMemo)(()=>{if(!W||!ea)return console.error("Contract or userAddress is undefined"),console.log("Contract:",ea),console.log("User Address:",W),[]},[ea,W,ee]),{send:es,data:er,isPending:ei}=(0,l.pQ)({calls:en}),{data:el,status:eo,isLoading:ec,isError:ep,error:eh}=(0,l.VS)({hash:null==er?void 0:er.transaction_hash,watch:!0}),eu=(0,s.useMemo)(()=>new o.Gf({nodeUrl:_.env.NEXT_PUBLIC_RPC_URL}),[]),[ed,em]=(0,s.useState)([]),ef=(0,s.useRef)(0),{data:eg}=(0,l.Ov)({refetchInterval:3e3}),e_=(0,s.useCallback)(async(e,t)=>{if(!(t<=ef.current))try{let a=ef.current+1,n=await eu.getEvents({address:e.address,from_block:{block_number:a},to_block:{block_number:t},chunk_size:500});n&&n.events&&em(e=>[...e,...n.events]),ef.current=t}catch(e){console.error("Error checking for events:",e)}},[eu]);(0,s.useEffect)(()=>{ea&&eg&&e_(ea,eg)},[ea,eg,e_]),(0,s.useMemo)(()=>[...ed].reverse().slice(0,5),[ed]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{v(!0),setTimeout(()=>x(!1),1e3)},2e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{(async()=>{if(W&&I){let e=await ej(I),t=await ev(I);if(e===W){let e=await ek(W);G(t?await ek(t):null),Y(e)}else{let t=await ek(W),a=e?await ek(e):null;G(t),Y(a)}}})()},[W,I]),(0,s.useEffect)(()=>{(async()=>{W&&I&&X(await ej(I)!==W)})()},[W,I]);let ey=async()=>{if(ea&&W)try{"Puppet"===E?S(1):"Gizmo"===E&&S(2),await eb(z,I)&&B(!0)}catch(e){console.error("Error sending transaction:",e)}},eb=(0,s.useCallback)(async(e,t)=>{if(!V)return!1;O(!0),R(void 0);try{let{transaction_hash:a}=await V.execute([{contractAddress:$,entrypoint:"create_game",calldata:[e,t]}]);return R(a),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[V]),ew=(0,s.useCallback)(async e=>{if(!V)return!1;O(!0),R(void 0);try{let{transaction_hash:t}=await V.execute([{contractAddress:$,entrypoint:"join_game",calldata:[e]}]);return R(t),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[V]),ex=(0,s.useCallback)(async(e,t)=>{if(!V)return!1;O(!0),R(void 0);try{let{transaction_hash:a}=await V.execute([{contractAddress:$,entrypoint:"throw",calldata:[e,t]}]);return R(a),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[V]);(0,s.useCallback)(async e=>{if(!V)return null;O(!0),R(void 0);try{let t=await V.callContract({contractAddress:$,entrypoint:"game_winner",calldata:[e]});return console.log("Game winner:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling game_winner:",e),null}finally{O(!1)}},[V]);let ek=(0,s.useCallback)(async e=>{if(!V)return null;O(!0),R(void 0);try{let t=await V.callContract({contractAddress:$,entrypoint:"player_health",calldata:[e]});return console.log("Player health:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling player_health:",e),null}finally{O(!1)}},[V]),ev=(0,s.useCallback)(async e=>{if(!V)return null;O(!0),R(void 0);try{let t=await V.callContract({contractAddress:$,entrypoint:"get_first_player",calldata:[e]});return console.log("First player:",t),t[0]}catch(e){return console.error("Error calling get_first_player:",e),null}finally{O(!1)}},[V]),ej=(0,s.useCallback)(async e=>{if(!V)return null;O(!0),R(void 0);try{let t=await V.callContract({contractAddress:$,entrypoint:"get_second_player",calldata:[e]});return console.log("Second player:",t),t[0]}catch(e){return console.error("Error calling get_second_player:",e),null}finally{O(!1)}},[V]),eP=(0,s.useCallback)(async e=>{if(!V)return null;O(!0),R(void 0);try{let t=await V.callContract({contractAddress:$,entrypoint:"get_game_turn",calldata:[e]});return console.log("Game turn:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling get_game_turn:",e),null}finally{O(!1)}},[V]);return(0,n.jsx)("div",{className:"game-screen ".concat("Puppet"===E?"puppet-bg":"Gizmo"===E?"gizmo-bg":""),style:{opacity:k?1:0},children:j?(0,n.jsx)("div",{className:"screen",children:N?(0,n.jsx)(n.Fragment,{children:L?(0,n.jsx)(y,{player1Hp:D,player2Hp:U,throwStone:ex,gameId:I,getGameTurn:eP,getFirstPlayer:ev,getSecondPlayer:ej,getPlayerHealth:ek,userAddress:null!=W?W:null,isPlayer1:null!=q&&q}):(0,n.jsxs)(n.Fragment,{children:["Puppet"===E&&(0,n.jsxs)("div",{className:"puppet-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:d.src,alt:"Back",onClick:()=>A(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:m.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:ey,children:"CREATE GAME"}),(0,n.jsxs)("div",{className:"game-id-input",children:[(0,n.jsx)("input",{className:"game-id-input-field",type:"number",value:I,onChange:e=>F(parseInt(e.target.value))}),(0,n.jsx)("button",{className:"join-button",onClick:H,children:"JOIN GAME"})]})]})]})]})]})]}),"Gizmo"===E&&(0,n.jsxs)("div",{className:"gizmo-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:d.src,alt:"Back",onClick:()=>A(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:f.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:ey,children:"CREATE GAME"}),(0,n.jsxs)("div",{className:"game-id-input",children:[(0,n.jsx)("input",{className:"game-id-input-field",type:"number",value:I,onChange:e=>F(parseInt(e.target.value))}),(0,n.jsx)("button",{className:"join-button",onClick:H,children:"JOIN GAME"})]})]})]})]})]})]})]})}):(0,n.jsxs)("div",{className:"character-select-screen",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:d.src,alt:"Back",onClick:()=>P(!1)})}),(0,n.jsxs)("div",{className:"character-select-container",children:[(0,n.jsxs)("div",{id:"puppet-selector",className:"character-selector",onClick:()=>{C("Puppet"),A(!0)},children:[(0,n.jsx)("img",{src:m.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{id:"gizmo-selector",className:"character-selector",onClick:()=>{C("Gizmo"),A(!0)},children:[(0,n.jsx)("img",{src:f.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]})]}),(0,n.jsx)("div",{className:"select-container",children:(0,n.jsx)("img",{className:"select-svg",src:g.src,alt:"Select"})})]})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"character left-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Puppet"}),(0,n.jsx)("img",{src:p.src,className:"App-left-character",alt:"Left Character"})]}),(0,n.jsxs)("div",{className:"vs-container",children:[(0,n.jsx)("img",{src:u.src,className:"App-vs",alt:"VS"}),(0,n.jsxs)("div",{className:"play-button-container",children:[(0,n.jsx)("button",{className:"start-game-button-text",onClick:()=>{W?(alert("Wallet Address: ".concat(W)),P(!0)):alert("Please connect your wallet")},children:"START GAME"}),i.map((e,t)=>(0,n.jsx)("button",{className:"play-button",onClick:()=>r({connector:e}),children:W?"CONNECTED":"CONNECT"},t))]})]}),(0,n.jsxs)("div",{className:"character right-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Gizmo"}),(0,n.jsx)("img",{src:h.src,className:"App-right-character",alt:"Right Character"})]})]})})}}},function(e){e.O(0,[541,652,412,274,936,744],function(){return e(e.s=8095)}),_N_E=e.O()}]);