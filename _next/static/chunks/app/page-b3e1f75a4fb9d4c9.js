(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8095:function(e,t,a){Promise.resolve().then(a.bind(a,2522))},7568:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let n=a(4981);a(5320),a(8978);let s=n._(a(6080));function i(e,t){var a;let n={loading:e=>{let{error:t,isLoading:a,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let i={...n,...t};return(0,s.default)({...i,modules:null==(a=i.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7208:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=a(8165);function s(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return a}},6080:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let n=a(5320),s=a(8978),i=a(7208),r=a(7893);function o(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},a=(0,s.lazy)(()=>t.loader().then(o)),c=t.loading;function h(e){let o=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(r.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(s.Suspense,{fallback:o,children:l})}return h.displayName="LoadableComponent",h}},7893:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return i}});let n=a(5320),s=a(6334);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,s.getExpectedRequestStore)("next/dynamic css"),i=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));i.push(...t)}}return 0===i.length?null:(0,n.jsx)(n.Fragment,{children:i.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},2522:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var n=a(5320),s=a(8978),i=a(7568),r=a.n(i),o=a(5452),l=a(8439);let c=[{name:"actions__ContractImpl",type:"impl",interface_name:"dojo::contract::interface::IContract"},{name:"dojo::contract::interface::IContract",type:"interface",items:[]},{name:"actions__DeployedContractImpl",type:"impl",interface_name:"dojo::meta::interface::IDeployedResource"},{name:"core::byte_array::ByteArray",type:"struct",members:[{name:"data",type:"core::array::Array::<core::bytes_31::bytes31>"},{name:"pending_word",type:"core::felt252"},{name:"pending_word_len",type:"core::integer::u32"}]},{name:"dojo::meta::interface::IDeployedResource",type:"interface",items:[{name:"dojo_name",type:"function",inputs:[],outputs:[{type:"core::byte_array::ByteArray"}],state_mutability:"view"}]},{name:"ActionsImpl",type:"impl",interface_name:"puppet_vs_gizmo::systems::actions::IActions"},{name:"puppet_vs_gizmo::systems::actions::IActions",type:"interface",items:[{name:"create_game",type:"function",inputs:[{name:"character",type:"core::integer::u8"},{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{name:"join_game",type:"function",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{name:"throw",type:"function",inputs:[{name:"game_id",type:"core::integer::u32"},{name:"power",type:"core::integer::u8"}],outputs:[],state_mutability:"external"},{name:"player_health",type:"function",inputs:[{name:"address",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{name:"game_winner",type:"function",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{name:"get_first_player",type:"function",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"},{name:"get_second_player",type:"function",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"}]},{name:"dojo_init",type:"function",inputs:[],outputs:[],state_mutability:"view"},{name:"WorldProviderImpl",type:"impl",interface_name:"dojo::contract::components::world_provider::IWorldProvider"},{name:"dojo::world::iworld::IWorldDispatcher",type:"struct",members:[{name:"contract_address",type:"core::starknet::contract_address::ContractAddress"}]},{name:"dojo::contract::components::world_provider::IWorldProvider",type:"interface",items:[{name:"world_dispatcher",type:"function",inputs:[],outputs:[{type:"dojo::world::iworld::IWorldDispatcher"}],state_mutability:"view"}]},{name:"UpgradeableImpl",type:"impl",interface_name:"dojo::contract::components::upgradeable::IUpgradeable"},{name:"dojo::contract::components::upgradeable::IUpgradeable",type:"interface",items:[{name:"upgrade",type:"function",inputs:[{name:"new_class_hash",type:"core::starknet::class_hash::ClassHash"}],outputs:[],state_mutability:"external"}]},{name:"constructor",type:"constructor",inputs:[]},{kind:"struct",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded",type:"event",members:[{kind:"data",name:"class_hash",type:"core::starknet::class_hash::ClassHash"}]},{kind:"enum",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Event",type:"event",variants:[{kind:"nested",name:"Upgraded",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded"}]},{kind:"enum",name:"dojo::contract::components::world_provider::world_provider_cpt::Event",type:"event",variants:[]},{kind:"enum",name:"puppet_vs_gizmo::systems::actions::actions::Event",type:"event",variants:[{kind:"nested",name:"UpgradeableEvent",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Event"},{kind:"nested",name:"WorldProviderEvent",type:"dojo::contract::components::world_provider::world_provider_cpt::Event"}]}];var h={src:"/Puppet//_next/static/media/puppet_preview.82f41b7d.png"},p={src:"/Puppet//_next/static/media/gizmo_preview.1253c5ed.png"},d={src:"/Puppet//_next/static/media/versus.b298df6b.png"},m={src:"/Puppet//_next/static/media/back.33c5057d.png"},f={src:"/Puppet//_next/static/media/small_puppet.9a537536.png"},u={src:"/Puppet//_next/static/media/small_gizmo.c7725c5d.png"},g={src:"/Puppet//_next/static/media/select.be584483.png"},_=a(9767);function y(){return(0,s.useEffect)(()=>{let e=document.getElementById("gameCanvas"),t=null==e?void 0:e.getContext("2d",{alpha:!1});e.width=1280,e.height=522;let a={x:15,y:e.height-350,width:256,height:316,hitboxHeight:316/6,hp:100,maxHp:100},n={x:e.width-290,y:e.height-350,width:256,height:316,hitboxHeight:316/6,hp:100,maxHp:100},s=performance.now(),i=!1,r=1,o=!0,l=null,c=!1,h=0,p={x:543,y:315,width:187.5,height:180},d=["https://klanfontan.github.io/assets/puppet_frames_death/frame_00.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_01.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_02.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_03.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_04.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_05.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_06.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_07.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_08.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_09.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_10.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_11.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_12.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_13.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_14.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_15.png"],m=["https://klanfontan.github.io/assets/gizmo_frames_death/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_11.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_12.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_13.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_14.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_15.png"],f=[],u=[],g=new Image;g.src="https://klanfontan.github.io/game/Puppet-main/gamecode/background.png";let _=new Image;_.src="https://klanfontan.github.io/game/Puppet-main/gamecode/emptyHpBar.png";let y=new Image;y.src="https://klanfontan.github.io/assets/puppet_frames/frame_00.png";let b=new Image;b.src="https://klanfontan.github.io/assets/gizmo_stars/frame_00.png";let x=new Image;x.src="https://klanfontan.github.io/game/Puppet-main/gamecode/backButton.png";let w={x:50,y:55,width:125,height:45},k=new Image;k.src="https://klanfontan.github.io/img/versus.svg";let v=new Image;v.src="https://klanfontan.github.io/img/square_gizmo.png";let j=new Image;j.src="https://klanfontan.github.io/img/square_puppet.png";let P="Gizmo",E=a.hp,C=n.hp,I=!1,N=!1,A=0,z=0;function F(){z=12*Math.random()-6}function T(e,a,n,s,i){t&&(t.beginPath(),t.moveTo(e,a),t.lineTo(e+n,a-i/2),t.lineTo(e+n,a+i/2),t.closePath(),t.fill(),"#FFFFFF"!==t.fillStyle&&(t.lineWidth=2,t.strokeStyle="#FFFFFF",t.stroke()))}let O=document.createElement("canvas"),S=O.getContext("2d");function M(){t&&t.drawImage(O,0,0)}O.width=e.width,O.height=e.height;let R=0,L=0,B=0,D=0;function U(e){let s=!Q&&(e===a&&I||e===n&&N),i=Date.now()-A;if(s&&i<500){if(!t)return;t.globalAlpha=Math.floor(i/100)%2==0?.5:1}else{if(e===a&&(I=!1),e===n&&(N=!1),!t)return;t.globalAlpha=1}e===a?t.drawImage(y,e.x,e.y,e.width,e.height):t.drawImage(b,e.x,e.y,e.width,e.height);let r=performance.now();if(r-ei>50&&(es=(es+1)%en.length,ei=r),e===a){if(B>0){let e=r-B;e<1e3?R=1-e/1e3:(R=0,B=0)}t.globalAlpha=R}else{if(D>0){let e=r-D;e<1e3?L=1-e/1e3:(L=0,D=0)}t.globalAlpha=L}let o=e.x+(e.width-125)/2,l=e.y-31.25+60;t.drawImage(en[es],o,l,125,125),t.globalAlpha=1}function Y(){let s=e.width-350-150;if(!t)return;t.fillStyle="white",t.font="28px Fortnite",t.textAlign="right",t.shadowColor="rgba(100, 13, 13, 1)",t.shadowOffsetX=0,t.shadowOffsetY=4,t.fillText(P,460,45),t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="rgba(232, 44, 64, 1)";let i=e.width/2-t.measureText(P).width-260;G(i,29,70,30,5),t.fillStyle="white",t.font="18px Fortnite",t.textAlign="center",t.shadowColor="rgba(0, 0, 0, 0.1)",t.shadowOffsetX=0,t.shadowOffsetY=3,t.fillText("PUPPET",i+35,46),t.shadowOffsetX=0,t.shadowOffsetY=0,E>a.hp&&(E-=.5)<a.hp&&(E=a.hp),t.fillStyle="white",G(150,70,350,12,6),t.fillStyle="red",E>0&&G(152,72,E/a.maxHp*346,8,4),t.fillStyle="white",t.font="28px Fortnite",t.textAlign="left",t.shadowColor="rgba(100, 13, 13, 1)",t.shadowOffsetX=0,t.shadowOffsetY=4,t.fillText(P,e.width-460,45),t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="rgba(137, 223, 111, 1)";let r=t.measureText(P).width,o=e.width/2+r+190;G(o,29,70,30,5),t.fillStyle="white",t.font="18px Fortnite",t.textAlign="center",t.shadowColor="rgba(0, 0, 0, 0.1)",t.shadowOffsetX=0,t.shadowOffsetY=3,t.fillText("GIZMO",o+35,46),t.shadowOffsetX=0,t.shadowOffsetY=0,C>n.hp&&(C-=.5)<n.hp&&(C=n.hp),t.fillStyle="white",G(s,70,350,12,6),t.fillStyle="red",C>0&&G(s+2+346*(1-C/n.maxHp),72,C/n.maxHp*346,8,4)}function G(e,a,n,s,i){t&&(t.beginPath(),t.moveTo(e+i,a),t.lineTo(e+n-i,a),t.quadraticCurveTo(e+n,a,e+n,a+i),t.lineTo(e+n,a+s-i),t.quadraticCurveTo(e+n,a+s,e+n-i,a+s),t.lineTo(e+i,a+s),t.quadraticCurveTo(e,a+s,e,a+s-i),t.lineTo(e,a+i),t.quadraticCurveTo(e,a,e+i,a),t.closePath(),t.fill())}function X(){r=1===r?2:1,o=!0,F(),2===r&&2===r&&o&&(n.hp<n.maxHp/2&&!ep[1].used?setTimeout(()=>{setTimeout(()=>{er=!1,Z()},500)},500):(er=!0,setTimeout(()=>{er=!1,Z()},800*Math.random()+400)))}e.addEventListener("mousedown",e=>{o&&!l&&1===r&&(c=!0,er=!0)}),e.addEventListener("mouseup",e=>{c&&o&&1===r&&(c=!1,er=!1,Z())});let q=["https://klanfontan.github.io/assets/puppet_frames/frame_00.png","https://klanfontan.github.io/assets/puppet_frames/frame_01.png","https://klanfontan.github.io/assets/puppet_frames/frame_02.png","https://klanfontan.github.io/assets/puppet_frames/frame_03.png","https://klanfontan.github.io/assets/puppet_frames/frame_04.png","https://klanfontan.github.io/assets/puppet_frames/frame_05.png","https://klanfontan.github.io/assets/puppet_frames/frame_06.png","https://klanfontan.github.io/assets/puppet_frames/frame_07.png","https://klanfontan.github.io/assets/puppet_frames/frame_08.png","https://klanfontan.github.io/assets/puppet_frames/frame_09.png","https://klanfontan.github.io/assets/puppet_frames/frame_10.png","https://klanfontan.github.io/assets/puppet_frames/frame_11.png"],H=["https://klanfontan.github.io/assets/gizmo_stars/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames/frame_11.png"],W=0;function V(e){return Promise.all(e.map(e=>new Promise((t,a)=>{let n=new Image;n.src=e,n.onload=t,n.onerror=a})))}function Z(){let e;let t=.5*z,s=3.2+h;1===r?(e=J(q,y,"https://klanfontan.github.io/assets/puppet_frames/frame_00.png"),l={x:a.x+a.width-210,y:a.y+a.height/2+20,speedX:s+t,speedY:-(1.5*s)}):(e=J(H,b,"https://klanfontan.github.io/assets/gizmo_frames/frame_00.png"),l={x:n.x+210,y:n.y+n.height/2+20,speedX:-s+t,speedY:-(1.5*s)}),h=0,o=!1,setTimeout(()=>{e()},350)}function J(e,t,a){W=0;let n=performance.now(),s=!0;return requestAnimationFrame(function a(i){s&&(i-n>=25&&(t.src=e[W],W=(W+1)%e.length,n=i),requestAnimationFrame(a))}),function(){s=!1,t.src=a}}Promise.all([V(q),V(H)]).then(()=>{$()}).catch(e=>{console.error("Ошибка загрузки кадров:",e)});let Q=!1,K=!0;function $(){if(K)return;let c=performance.now(),d=(c-s)/1e3;if(s=c,t){let s,c,m,g,_;t.clearRect(0,0,e.width,e.height),M(),er&&h<8&&o&&(h+=6*d),l&&(l.x+=l.speedX*d*100,l.y+=l.speedY*d*100,l.speedY+=.17*d*100,(l.x>e.width||l.x<0||l.y>e.height)&&(l=null,X())),function(){if(l){var s,o,c,h,d,m,g,_;if(l.x>=p.x&&l.x<=p.x+p.width&&l.y>=p.y&&l.y<=p.y+p.height||(s=l.x,o=l.y,c=p.x,h=p.y,d=p.x+p.width/2,m=p.y-80,g=p.x+p.width,.1>Math.abs(Math.abs((d-c)*((_=p.y)-h)-(g-c)*(m-h))/2-(Math.abs((c-s)*(m-o)-(d-s)*(h-o))/2+Math.abs((d-s)*(_-o)-(g-s)*(m-o))/2+Math.abs((g-s)*(h-o)-(c-s)*(_-o))/2)))){l=null,X();return}let k=1===r?n:a,v=k.y+(k.height-k.hitboxHeight)/2,j=Math.max(k.x,Math.min(l.x,k.x+k.width)),P=Math.max(v,Math.min(l.y,v+k.hitboxHeight));if(10>=Math.sqrt((l.x-j)**2+(l.y-P)**2)){if(k.hp-=15,k.hp<=0&&(k.hp=0,k.height=k.height/1.5,k.y=e.height-k.height-34),l=null,k===n?(N=!0,D=performance.now()):(I=!0,B=performance.now()),A=Date.now(),0!==k.hp||i)X();else{Q=!0,i=!0;let s=1===r?"Puppet":"Gizmo",o=1===r?2:1;if(I=!1,N=!1,!t)return;t.globalAlpha=1,cancelAnimationFrame($),function(s,i){console.log("Starting death animation for player",s);let r=0,o=0,l=1===s?f:u;if(0===l.length){console.error("No death animation frames loaded!"),i&&i();return}!function c(){if(r>=l.length){if(++o<6){r=0,requestAnimationFrame(()=>setTimeout(c,25));return}console.log("Animation complete after",6,"plays"),i&&i();return}(1===s?y:b).src=l[r].src,t&&(t.clearRect(0,0,e.width,e.height),M(),U(a),U(n),Y(),r++,requestAnimationFrame(()=>setTimeout(c,25)))}()}(o,()=>{setTimeout(()=>{(function(a){Q=!0;let n="Puppet"===a?"#E82C40":"#89DF6F",s=0,i=10,r=Date.now();ee=!0,function o(){let l=Math.min((Date.now()-r)/2e3,1),c=l<.5?2*l*l:-1+(4-2*l)*l;s=c,i=10+38*c,t&&(t.clearRect(0,0,e.width,e.height),t.fillStyle="rgba(".concat(parseInt(n.slice(1,3),16),", ").concat(parseInt(n.slice(3,5),16),", ").concat(parseInt(n.slice(5,7),16),", ").concat(s,")"),t.fillRect(0,0,e.width,e.height),t.fillStyle="rgba(255, 255, 255, ".concat(s,")"),t.font="".concat(i,"px Fortnite"),t.textAlign="center",t.textBaseline="middle",t.fillText("Game Over! ".concat(a," wins!"),e.width/2,e.height/2),ee&&(t.globalAlpha=s,t.drawImage(x,w.x,w.y,w.width,w.height),t.globalAlpha=1),l<1&&requestAnimationFrame(o))}()})(s)},0)})}}}}(),t.globalAlpha=1,U(a),U(n),l&&l&&t&&(t.fillStyle="gray",t.beginPath(),t.arc(l.x,l.y,10,0,2*Math.PI),t.fill()),(Q||i)&&(ed=Math.max(0,ed-.05)),t.globalAlpha=ed,Y(),ep.forEach((e,a)=>{if(!e.used){if(1===a)t&&(t.save(),t.translate(e.x+e.width/2,e.y+e.height/2),t.scale(-1,1),t.drawImage(eh,-e.width/2,-e.height/2,e.width,e.height),t.restore());else{if(!t)return;t.drawImage(eh,e.x,e.y,e.width,e.height)}}}),function(){let a=(e.width-200)/2;if(!t)return;t.shadowColor="#03043E",t.shadowOffsetX=0,t.shadowOffsetY=4,t.shadowBlur=0,t.fillStyle="#B3B4FE",t.fillRect(a,125,200,40),t.shadowColor="transparent",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0;let n=Math.max(-6,Math.min(6,z));t.fillStyle="#FFFFFF",t.fillRect(a+100,125,n/6*100,40),t.fillStyle="#0003FA",t.font="28px Fortnite",t.textAlign="center",t.fillText("Wind",e.width/2,146),t.fillStyle=n<0?"#FFFFFF":"#B3B4FE",T(a-20-35,145,40,0,20),t.fillStyle=n>0?"#FFFFFF":"#B3B4FE",T(a+200+20+35,145,-40,0,20)}(),ec(t),Q||el(t),o&&t&&(1===r?(s=a.x+a.width/1.55,c=a.y+150,g=(m=5*Math.PI/4+Math.PI-Math.PI/6)-h/8*(_=.85*Math.PI)):(s=n.x+n.width/2.5,c=n.y+150,g=(m=3*Math.PI/4+Math.PI/6)+h/8*(_=.85*Math.PI)),t.beginPath(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=30,t.arc(s,c,125,m,m+(1===r?-_:_),1===r),t.stroke(),er&&(t.beginPath(),t.strokeStyle="white",t.lineWidth=30,t.arc(s,c,125,m,g,1===r),t.stroke())),t.globalAlpha=1,Q&&null===l||requestAnimationFrame($)}}let ee=!1,et=3,ea=["https://klanfontan.github.io/assets/gizmo_stars/frame_00.png","https://klanfontan.github.io/assets/gizmo_stars/frame_01.png","https://klanfontan.github.io/assets/gizmo_stars/frame_02.png","https://klanfontan.github.io/assets/gizmo_stars/frame_03.png","https://klanfontan.github.io/assets/gizmo_stars/frame_04.png","https://klanfontan.github.io/assets/gizmo_stars/frame_05.png","https://klanfontan.github.io/assets/gizmo_stars/frame_06.png","https://klanfontan.github.io/assets/gizmo_stars/frame_07.png","https://klanfontan.github.io/assets/gizmo_stars/frame_08.png","https://klanfontan.github.io/assets/gizmo_stars/frame_09.png","https://klanfontan.github.io/assets/gizmo_stars/frame_10.png"],en=[],es=0,ei=0;Promise.all([new Promise(e=>g.onload=e),new Promise(e=>_.onload=e),new Promise(e=>y.onload=e),new Promise(e=>b.onload=e)]).then(()=>{(function(){let e=0,t=d.length+m.length;function a(){e++,console.log("Loaded ".concat(e,"/").concat(t," death frames"))}d.forEach(e=>{let t=new Image;t.onload=a,t.src=e,f.push(t)}),m.forEach(e=>{let t=new Image;t.onload=a,t.src=e,u.push(t)})})(),ea.forEach(e=>{let t=new Image;t.src=e,en.push(t)}),S&&(S&&S.drawImage(g,0,0,e.width,e.height),ec(S),el(S)),F(),function a(){t&&(t.clearRect(0,0,e.width,e.height),t.fillStyle="rgba(232, 44, 64, 1)",t.fillRect(0,0,e.width,e.height),t.fillStyle="white",t.font="100px Fortnite",t.textAlign="center",t.textBaseline="middle",t.fillText(et.toString(),e.width/2,e.height/2),et>1?(et--,setTimeout(a,1e3)):setTimeout(()=>{et=3,K=!1,$()},1e3))}()}),e.addEventListener("click",t=>{if(ee){let s=e.getBoundingClientRect(),c=t.clientX-s.left,p=t.clientY-s.top;c>=w.x&&c<=w.x+w.width&&p>=w.y&&p<=w.y+w.height&&(a.hp=a.maxHp,n.hp=n.maxHp,r=1,o=!0,l=null,h=0,Q=!1,i=!1,$(),ee=!1)}});let er=!1;function eo(t,a){let n=e.getBoundingClientRect();return t>=n.left&&t<=n.right&&a>=n.top&&a<=n.bottom}function el(t){let a=e.width/2;t.drawImage(k,a-37.5,30,75,63)}function ec(t){let a=e.width/2+100-30,n=e.width/2-100-65;t.drawImage(v,a,10,100,100),t.drawImage(j,n,10,100,100)}e.addEventListener("touchstart",t=>{let a=t.changedTouches[0],n=a.clientX,s=a.clientY;if(ee&&(e.getBoundingClientRect(),n>=w.x&&n<=w.x+w.width&&s>=w.y&&s<=w.y+w.height)){window.location.href="../../../index.html";return}let i=!1;if(ep.forEach((e,t)=>{if(!e.used&&n>=e.x&&n<=e.x+e.width&&s>=e.y&&s<=e.y+e.height){i=!0;return}}),!i&&eo(n,s)){if(t.preventDefault(),1!==r)return;!o||l||1!==r||(er=!0)}}),e.addEventListener("touchend",e=>{let t=e.changedTouches[0];if(eo(t.clientX,t.clientY)){if(e.preventDefault(),1!==r)return;er&&(er=!1,Z())}}),e.addEventListener("touchmove",e=>{e.preventDefault()}),new FontFace("Fortnite","url(https://klanfontan.github.io/game/Puppet-main/gamecode/frt.otf)").load().then(function(e){document.fonts.add(e),t&&(t.font="48px Fortnite")}).catch(function(e){console.error("Ошибка загрузки шрифта:",e)});let eh=new Image;eh.src="https://klanfontan.github.io/game/Puppet-main/gamecode/potion.png";let ep=[{x:65,y:35,width:50,height:70,used:!1},{x:e.width-115,y:35,width:50,height:70,used:!1}];e.addEventListener("click",t=>{t.preventDefault();let a=e.getBoundingClientRect(),n=t.clientX-a.left,s=t.clientY-a.top;ep.forEach((e,t)=>{!e.used&&n>=e.x&&n<=e.x+e.width&&s>=e.y&&(e.y,e.height)})});let ed=1},[]),(0,n.jsx)("canvas",{id:"gameCanvas",width:"1280",height:"522"})}r()(()=>a.e(959).then(a.bind(a,2959)),{loadableGenerated:{webpack:()=>[2959]},ssr:!1});var b=()=>{let{data:e,isLoading:t,isError:a}=(0,o.Ov)({blockIdentifier:"latest"}),{connect:i,connectors:r}=(0,o.$4)(),{disconnect:b}=(0,o.qL)(),[x,w]=(0,s.useState)(!0),[k,v]=(0,s.useState)(!1),[j,P]=(0,s.useState)(!1),[E,C]=(0,s.useState)(null),[I,N]=(0,s.useState)(!1),[A,z]=(0,s.useState)(0),[F,T]=(0,s.useState)(0),[O,S]=(0,s.useState)(!1),[M,R]=(0,s.useState)(),[L,B]=(0,s.useState)(!1),D=async()=>{if(Q&&Y)try{await em(),B(!0)}catch(e){console.error("Error sending transaction:",e)}},U=async()=>{if(Q&&Y)try{await ef(),B(!0)}catch(e){console.error("Error sending transaction:",e)}},{address:Y}=(0,o.mA)(),{account:G}=(0,o.mA)(),{isLoading:X,isError:q,error:H,data:W}=(0,o.KQ)({address:Y,watch:!0}),V="0x0409f17fbe2145d007c6d18731fa9919e943a60230fe5c2647f702615a49e4f9",[Z,J]=(0,s.useState)(0),{contract:Q}=(0,o.cq)({abi:c,address:V}),K=(0,s.useMemo)(()=>{if(!Y||!Q)return console.error("Contract or userAddress is undefined"),console.log("Contract:",Q),console.log("User Address:",Y),[]},[Q,Y,Z]),{send:$,data:ee,isPending:et}=(0,o.pQ)({calls:K}),{data:ea,status:en,isLoading:es,isError:ei,error:er}=(0,o.VS)({hash:null==ee?void 0:ee.transaction_hash,watch:!0}),eo=(0,s.useMemo)(()=>new l.Gf({nodeUrl:_.env.NEXT_PUBLIC_RPC_URL}),[]),[el,ec]=(0,s.useState)([]),eh=(0,s.useRef)(0),{data:ep}=(0,o.Ov)({refetchInterval:3e3}),ed=(0,s.useCallback)(async(e,t)=>{if(!(t<=eh.current))try{let a=eh.current+1,n=await eo.getEvents({address:e.address,from_block:{block_number:a},to_block:{block_number:t},chunk_size:500});n&&n.events&&ec(e=>[...e,...n.events]),eh.current=t}catch(e){console.error("Error checking for events:",e)}},[eo]);(0,s.useEffect)(()=>{Q&&ep&&ed(Q,ep)},[Q,ep,ed]),(0,s.useMemo)(()=>[...el].reverse().slice(0,5),[el]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{v(!0),setTimeout(()=>w(!1),1e3)},2e3);return()=>clearTimeout(e)},[]);let em=(0,s.useCallback)(async()=>{G&&(S(!0),R(void 0),G.execute([{contractAddress:V,entrypoint:"create_game",calldata:[1,4]}]).then(e=>{let{transaction_hash:t}=e;return R(t)}).catch(e=>console.error(e)).finally(()=>S(!1)))},[G]),ef=(0,s.useCallback)(async()=>{G&&(S(!0),R(void 0),G.execute([{contractAddress:V,entrypoint:"join_game",calldata:[4]}]).then(e=>{let{transaction_hash:t}=e;return R(t)}).catch(e=>console.error(e)).finally(()=>S(!1)))},[G]);return(0,s.useCallback)(async()=>{if(G){S(!0),R(void 0);try{let e=await G.callContract({contractAddress:V,entrypoint:"player_health",calldata:["0x792cf6265c21b922c740dad0c0d4fdb330747833f5d45a155e62557194319e1"]});return console.log("Player health:",e),e}catch(e){return console.error("Error calling player_health:",e),null}finally{S(!1)}}},[G]),(0,s.useCallback)(async()=>{if(G){S(!0),R(void 0);try{let e=await G.callContract({contractAddress:V,entrypoint:"get_first_player",calldata:[2]});console.log("First player:",e)}catch(e){console.error("Error calling get_first_player:",e)}finally{S(!1)}}},[G]),(0,n.jsx)("div",{className:"game-screen ".concat("Puppet"===E?"puppet-bg":"Gizmo"===E?"gizmo-bg":""),style:{opacity:k?1:0},children:j?(0,n.jsx)("div",{className:"screen",children:I?(0,n.jsx)(n.Fragment,{children:L?(0,n.jsx)(y,{}):(0,n.jsxs)(n.Fragment,{children:["Puppet"===E&&(0,n.jsxs)("div",{className:"puppet-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:m.src,alt:"Back",onClick:()=>N(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:f.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:D,children:"CREATE GAME"}),(0,n.jsx)("button",{className:"join-button",onClick:U,children:"JOIN GAME"})]})]})]})]})]}),"Gizmo"===E&&(0,n.jsxs)("div",{className:"gizmo-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:m.src,alt:"Back",onClick:()=>N(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:u.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:D,children:"CREATE GAME"}),(0,n.jsx)("button",{className:"join-button",onClick:U,children:"JOIN GAME"})]})]})]})]})]})]})}):(0,n.jsxs)("div",{className:"character-select-screen",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:m.src,alt:"Back",onClick:()=>P(!1)})}),(0,n.jsxs)("div",{className:"character-select-container",children:[(0,n.jsxs)("div",{id:"puppet-selector",className:"character-selector",onClick:()=>{C("Puppet"),N(!0)},children:[(0,n.jsx)("img",{src:f.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{id:"gizmo-selector",className:"character-selector",onClick:()=>{C("Gizmo"),N(!0)},children:[(0,n.jsx)("img",{src:u.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]})]}),(0,n.jsx)("div",{className:"select-container",children:(0,n.jsx)("img",{className:"select-svg",src:g.src,alt:"Select"})})]})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"character left-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Puppet"}),(0,n.jsx)("img",{src:h.src,className:"App-left-character",alt:"Left Character"})]}),(0,n.jsxs)("div",{className:"vs-container",children:[(0,n.jsx)("img",{src:d.src,className:"App-vs",alt:"VS"}),(0,n.jsxs)("div",{className:"play-button-container",children:[(0,n.jsx)("button",{className:"start-game-button-text",onClick:()=>{Y?(alert("Wallet Address: ".concat(Y)),P(!0)):alert("Please connect your wallet")},children:"START GAME"}),r.map((e,t)=>(0,n.jsx)("button",{className:"play-button",onClick:()=>i({connector:e}),children:Y?"CONNECTED":"CONNECT"},t))]})]}),(0,n.jsxs)("div",{className:"character right-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Gizmo"}),(0,n.jsx)("img",{src:p.src,className:"App-right-character",alt:"Right Character"})]})]})})}}},function(e){e.O(0,[541,652,412,274,936,744],function(){return e(e.s=8095)}),_N_E=e.O()}]);