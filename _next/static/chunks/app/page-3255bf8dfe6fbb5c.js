(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8095:function(e,t,a){Promise.resolve().then(a.bind(a,2522))},7568:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=a(4981);a(5320),a(8978);let s=n._(a(6080));function r(e,t){var a;let n={loading:e=>{let{error:t,isLoading:a,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let r={...n,...t};return(0,s.default)({...r,modules:null==(a=r.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7208:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=a(8165);function s(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return a}},6080:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let n=a(5320),s=a(8978),r=a(7208),i=a(7893);function o(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},a=(0,s.lazy)(()=>t.loader().then(o)),c=t.loading;function p(e){let o=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(i.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(s.Suspense,{fallback:o,children:l})}return p.displayName="LoadableComponent",p}},7893:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return r}});let n=a(5320),s=a(6334);function r(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,s.getExpectedRequestStore)("next/dynamic css"),r=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));r.push(...t)}}return 0===r.length?null:(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},2522:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var n=a(5320),s=a(8978),r=a(7568),i=a.n(r),o=a(5452),l=a(8439);let c=[{type:"impl",name:"actions__ContractImpl",interface_name:"dojo::contract::interface::IContract"},{type:"interface",name:"dojo::contract::interface::IContract",items:[]},{type:"impl",name:"actions__DeployedContractImpl",interface_name:"dojo::meta::interface::IDeployedResource"},{type:"struct",name:"core::byte_array::ByteArray",members:[{name:"data",type:"core::array::Array::<core::bytes_31::bytes31>"},{name:"pending_word",type:"core::felt252"},{name:"pending_word_len",type:"core::integer::u32"}]},{type:"interface",name:"dojo::meta::interface::IDeployedResource",items:[{type:"function",name:"dojo_name",inputs:[],outputs:[{type:"core::byte_array::ByteArray"}],state_mutability:"view"}]},{type:"impl",name:"ActionsImpl",interface_name:"puppet_vs_gizmo::systems::actions::IActions"},{type:"interface",name:"puppet_vs_gizmo::systems::actions::IActions",items:[{type:"function",name:"create_game",inputs:[{name:"character",type:"core::integer::u8"},{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{type:"function",name:"join_game",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[],state_mutability:"external"},{type:"function",name:"throw",inputs:[{name:"game_id",type:"core::integer::u32"},{name:"power",type:"core::integer::u8"}],outputs:[],state_mutability:"external"},{type:"function",name:"player_health",inputs:[{name:"address",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{type:"function",name:"game_winner",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"},{type:"function",name:"get_first_player",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"},{type:"function",name:"get_second_player",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::starknet::contract_address::ContractAddress"}],state_mutability:"external"},{type:"function",name:"get_game_turn",inputs:[{name:"game_id",type:"core::integer::u32"}],outputs:[{type:"core::integer::u8"}],state_mutability:"external"}]},{type:"function",name:"dojo_init",inputs:[],outputs:[],state_mutability:"view"},{type:"impl",name:"WorldProviderImpl",interface_name:"dojo::contract::components::world_provider::IWorldProvider"},{type:"struct",name:"dojo::world::iworld::IWorldDispatcher",members:[{name:"contract_address",type:"core::starknet::contract_address::ContractAddress"}]},{type:"interface",name:"dojo::contract::components::world_provider::IWorldProvider",items:[{type:"function",name:"world_dispatcher",inputs:[],outputs:[{type:"dojo::world::iworld::IWorldDispatcher"}],state_mutability:"view"}]},{type:"impl",name:"UpgradeableImpl",interface_name:"dojo::contract::components::upgradeable::IUpgradeable"},{type:"interface",name:"dojo::contract::components::upgradeable::IUpgradeable",items:[{type:"function",name:"upgrade",inputs:[{name:"new_class_hash",type:"core::starknet::class_hash::ClassHash"}],outputs:[],state_mutability:"external"}]},{type:"constructor",name:"constructor",inputs:[]},{type:"event",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded",kind:"struct",members:[{name:"class_hash",type:"core::starknet::class_hash::ClassHash",kind:"data"}]},{type:"event",name:"dojo::contract::components::upgradeable::upgradeable_cpt::Event",kind:"enum",variants:[{name:"Upgraded",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Upgraded",kind:"nested"}]},{type:"event",name:"dojo::contract::components::world_provider::world_provider_cpt::Event",kind:"enum",variants:[]},{type:"event",name:"puppet_vs_gizmo::systems::actions::actions::Event",kind:"enum",variants:[{name:"UpgradeableEvent",type:"dojo::contract::components::upgradeable::upgradeable_cpt::Event",kind:"nested"},{name:"WorldProviderEvent",type:"dojo::contract::components::world_provider::world_provider_cpt::Event",kind:"nested"}]}];var p={src:"/Puppet//_next/static/media/puppet_preview.82f41b7d.png"},h={src:"/Puppet//_next/static/media/gizmo_preview.1253c5ed.png"},d={src:"/Puppet//_next/static/media/versus.b298df6b.png"},u={src:"/Puppet//_next/static/media/back.33c5057d.png"},m={src:"/Puppet//_next/static/media/small_puppet.9a537536.png"},f={src:"/Puppet//_next/static/media/small_gizmo.c7725c5d.png"},g={src:"/Puppet//_next/static/media/select.be584483.png"},_=a(9767);function y(e){let{player1Hp:t,player2Hp:a,throwStone:r,gameId:i,getGameTurn:o,getFirstPlayer:l,getSecondPlayer:c,getPlayerHealth:p,userAddress:h}=e;return(0,s.useEffect)(()=>{let e;let n=document.getElementById("gameCanvas"),s=null==n?void 0:n.getContext("2d",{alpha:!1});n.width=1280,n.height=522;let l={x:15,y:n.height-350,width:256,height:316,hitboxHeight:316/6,hp:t,maxHp:100},c={x:n.width-290,y:n.height-350,width:256,height:316,hitboxHeight:316/6,hp:a,maxHp:100},d=performance.now(),u=!1;(async()=>{e=await o(i)})();let m=!0,f=null,g=!1,_=0,y={x:543,y:315,width:187.5,height:180},b=["https://klanfontan.github.io/assets/puppet_frames_death/frame_00.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_01.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_02.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_03.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_04.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_05.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_06.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_07.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_08.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_09.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_10.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_11.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_12.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_13.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_14.png","https://klanfontan.github.io/assets/puppet_frames_death/frame_15.png"],x=["https://klanfontan.github.io/assets/gizmo_frames_death/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_11.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_12.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_13.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_14.png","https://klanfontan.github.io/assets/gizmo_frames_death/frame_15.png"],w=[],k=[],v=new Image;v.src="https://klanfontan.github.io/game/Puppet-main/gamecode/background.png";let j=new Image;j.src="https://klanfontan.github.io/game/Puppet-main/gamecode/emptyHpBar.png";let P=new Image;P.src="https://klanfontan.github.io/assets/puppet_frames/frame_00.png";let C=new Image;C.src="https://klanfontan.github.io/assets/gizmo_frames/frame_00.png";let E=new Image;E.src="https://klanfontan.github.io/game/Puppet-main/gamecode/backButton.png";let N={x:50,y:55,width:125,height:45},I=new Image;I.src="https://klanfontan.github.io/img/versus.svg";let A=new Image;A.src="https://klanfontan.github.io/img/square_gizmo.png";let F=new Image;F.src="https://klanfontan.github.io/img/square_puppet.png";let z="Gizmo",S=l.hp,T=c.hp,O=!1,M=!1,R=0,L=0;function B(){L=12*Math.random()-6}function D(e,t,a,n,r){s&&(s.beginPath(),s.moveTo(e,t),s.lineTo(e+a,t-r/2),s.lineTo(e+a,t+r/2),s.closePath(),s.fill(),"#FFFFFF"!==s.fillStyle&&(s.lineWidth=2,s.strokeStyle="#FFFFFF",s.stroke()))}let G=document.createElement("canvas"),U=G.getContext("2d");function Y(){s&&s.drawImage(G,0,0)}G.width=n.width,G.height=n.height;let X=0,H=0,q=0,W=0;function V(e){let t=!er&&(e===l&&O||e===c&&M),a=Date.now()-R;if(t&&a<500){if(!s)return;s.globalAlpha=Math.floor(a/100)%2==0?.5:1}else{if(e===l&&(O=!1),e===c&&(M=!1),!s)return;s.globalAlpha=1}e===l?s.drawImage(P,e.x,e.y,e.width,e.height):s.drawImage(C,e.x,e.y,e.width,e.height);let n=performance.now();if(n-em>50&&(eu=(eu+1)%ed.length,em=n),e===l){if(q>0){let e=n-q;e<1e3?X=1-e/1e3:(X=0,q=0)}s.globalAlpha=X}else{if(W>0){let e=n-W;e<1e3?H=1-e/1e3:(H=0,W=0)}s.globalAlpha=H}let r=e.x+(e.width-125)/2,i=e.y-31.25+60;s.drawImage(ed[eu],r,i,125,125),s.globalAlpha=1}function Z(){let e=n.width-350-150;if(!s)return;s.fillStyle="white",s.font="28px Fortnite",s.textAlign="right",s.shadowColor="rgba(100, 13, 13, 1)",s.shadowOffsetX=0,s.shadowOffsetY=4,s.fillText(z,460,45),s.shadowOffsetX=0,s.shadowOffsetY=0,s.fillStyle="rgba(232, 44, 64, 1)";let t=n.width/2-s.measureText(z).width-260;J(t,29,70,30,5),s.fillStyle="white",s.font="18px Fortnite",s.textAlign="center",s.shadowColor="rgba(0, 0, 0, 0.1)",s.shadowOffsetX=0,s.shadowOffsetY=3,s.fillText("PUPPET",t+35,46),s.shadowOffsetX=0,s.shadowOffsetY=0,null!==S&&null!==l.hp&&S>l.hp&&(S-=.5)<l.hp&&(S=l.hp),s.fillStyle="white",J(150,70,350,12,6),s.fillStyle="red",null!==S&&S>0&&J(152,72,S/l.maxHp*346,8,4),s.fillStyle="white",s.font="28px Fortnite",s.textAlign="left",s.shadowColor="rgba(100, 13, 13, 1)",s.shadowOffsetX=0,s.shadowOffsetY=4,s.fillText(z,n.width-460,45),s.shadowOffsetX=0,s.shadowOffsetY=0,s.fillStyle="rgba(137, 223, 111, 1)";let a=s.measureText(z).width,r=n.width/2+a+190;J(r,29,70,30,5),s.fillStyle="white",s.font="18px Fortnite",s.textAlign="center",s.shadowColor="rgba(0, 0, 0, 0.1)",s.shadowOffsetX=0,s.shadowOffsetY=3,s.fillText("GIZMO",r+35,46),s.shadowOffsetX=0,s.shadowOffsetY=0,null!==T&&null!==c.hp&&T>c.hp&&(T-=.5)<c.hp&&(T=c.hp),s.fillStyle="white",J(e,70,350,12,6),s.fillStyle="red",null!==T&&T>0&&J(e+2+346*(1-T/c.maxHp),72,T/c.maxHp*346,8,4)}function J(e,t,a,n,r){s&&(s.beginPath(),s.moveTo(e+r,t),s.lineTo(e+a-r,t),s.quadraticCurveTo(e+a,t,e+a,t+r),s.lineTo(e+a,t+n-r),s.quadraticCurveTo(e+a,t+n,e+a-r,t+n),s.lineTo(e+r,t+n),s.quadraticCurveTo(e,t+n,e,t+n-r),s.lineTo(e,t+r),s.quadraticCurveTo(e,t,e+r,t),s.closePath(),s.fill())}function Q(){e=1===e?2:1,m=!0,B(),2===e&&es()}n.addEventListener("mousedown",t=>{m&&!f&&1===e&&(g=!0,ef=!0)}),n.addEventListener("mouseup",t=>{g&&m&&1===e&&(g=!1,ef=!1,ea())});let K=["https://klanfontan.github.io/assets/puppet_frames/frame_00.png","https://klanfontan.github.io/assets/puppet_frames/frame_01.png","https://klanfontan.github.io/assets/puppet_frames/frame_02.png","https://klanfontan.github.io/assets/puppet_frames/frame_03.png","https://klanfontan.github.io/assets/puppet_frames/frame_04.png","https://klanfontan.github.io/assets/puppet_frames/frame_05.png","https://klanfontan.github.io/assets/puppet_frames/frame_06.png","https://klanfontan.github.io/assets/puppet_frames/frame_07.png","https://klanfontan.github.io/assets/puppet_frames/frame_08.png","https://klanfontan.github.io/assets/puppet_frames/frame_09.png","https://klanfontan.github.io/assets/puppet_frames/frame_10.png","https://klanfontan.github.io/assets/puppet_frames/frame_11.png"],$=["https://klanfontan.github.io/assets/gizmo_frames/frame_00.png","https://klanfontan.github.io/assets/gizmo_frames/frame_01.png","https://klanfontan.github.io/assets/gizmo_frames/frame_02.png","https://klanfontan.github.io/assets/gizmo_frames/frame_03.png","https://klanfontan.github.io/assets/gizmo_frames/frame_04.png","https://klanfontan.github.io/assets/gizmo_frames/frame_05.png","https://klanfontan.github.io/assets/gizmo_frames/frame_06.png","https://klanfontan.github.io/assets/gizmo_frames/frame_07.png","https://klanfontan.github.io/assets/gizmo_frames/frame_08.png","https://klanfontan.github.io/assets/gizmo_frames/frame_09.png","https://klanfontan.github.io/assets/gizmo_frames/frame_10.png","https://klanfontan.github.io/assets/gizmo_frames/frame_11.png"],ee=0;function et(e){return Promise.all(e.map(e=>new Promise((t,a)=>{let n=new Image;n.src=e,n.onload=t,n.onerror=a})))}function ea(){let t;let a=.5*L,n=3.2+_;1===e?(t=en(K,P,"https://klanfontan.github.io/assets/puppet_frames/frame_00.png"),f={x:l.x+l.width-210,y:l.y+l.height/2+20,speedX:n+a,speedY:-(1.5*n)}):(t=en($,C,"https://klanfontan.github.io/assets/gizmo_frames/frame_00.png"),f={x:c.x+210,y:c.y+c.height/2+20,speedX:-n+a,speedY:-(1.5*n)}),_=0,m=!1,setTimeout(()=>{t()},350)}function en(e,t,a){ee=0;let n=performance.now(),s=!0;return requestAnimationFrame(function a(r){s&&(r-n>=25&&(t.src=e[ee],ee=(ee+1)%e.length,n=r),requestAnimationFrame(a))}),function(){s=!1,t.src=a}}async function es(){if(2===e&&m){if(1===await o(i)){let e=await p(null!=h?h:"");h&&null!==e&&null!==l.hp&&e<l.hp?(ef=!0,setTimeout(()=>{ef=!1,ea(),f&&(f.x=l.x+l.width/2,f.y=l.y+l.height/2,el())},800*Math.random()+400)):setTimeout(()=>{es()},1e3)}else setTimeout(()=>{es()},1e3)}}Promise.all([et(K),et($)]).then(()=>{eo()}).catch(e=>{console.error("Ошибка загрузки кадров:",e)});let er=!1,ei=!0;function eo(){if(ei)return;let t=performance.now(),a=(t-d)/1e3;if(d=t,s){let t,r,i,o,p;s.clearRect(0,0,n.width,n.height),Y(),ef&&_<8&&m&&(_+=6*a),f&&(f.x+=f.speedX*a*100,f.y+=f.speedY*a*100,f.speedY+=.17*a*100,(f.x>n.width||f.x<0||f.y>n.height)&&(f=null,Q())),el(),s.globalAlpha=1,V(l),V(c),f&&f&&s&&(s.fillStyle="gray",s.beginPath(),s.arc(f.x,f.y,10,0,2*Math.PI),s.fill()),(er||u)&&(ew=Math.max(0,ew-.05)),s.globalAlpha=ew,Z(),ex.forEach((e,t)=>{if(!e.used){if(1===t)s&&(s.save(),s.translate(e.x+e.width/2,e.y+e.height/2),s.scale(-1,1),s.drawImage(eb,-e.width/2,-e.height/2,e.width,e.height),s.restore());else{if(!s)return;s.drawImage(eb,e.x,e.y,e.width,e.height)}}}),function(){let e=(n.width-200)/2;if(!s)return;s.shadowColor="#03043E",s.shadowOffsetX=0,s.shadowOffsetY=4,s.shadowBlur=0,s.fillStyle="#B3B4FE",s.fillRect(e,125,200,40),s.shadowColor="transparent",s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowBlur=0;let t=Math.max(-6,Math.min(6,L));s.fillStyle="#FFFFFF",s.fillRect(e+100,125,t/6*100,40),s.fillStyle="#0003FA",s.font="28px Fortnite",s.textAlign="center",s.fillText("Wind",n.width/2,146),s.fillStyle=t<0?"#FFFFFF":"#B3B4FE",D(e-20-35,145,40,0,20),s.fillStyle=t>0?"#FFFFFF":"#B3B4FE",D(e+200+20+35,145,-40,0,20)}(),ey(s),er||e_(s),m&&s&&(1===e?(t=l.x+l.width/1.55,r=l.y+150,o=(i=5*Math.PI/4+Math.PI-Math.PI/6)-_/8*(p=.85*Math.PI)):(t=c.x+c.width/2.5,r=c.y+150,o=(i=3*Math.PI/4+Math.PI/6)+_/8*(p=.85*Math.PI)),s.beginPath(),s.strokeStyle="rgba(255, 255, 255, 0.3)",s.lineWidth=30,s.arc(t,r,125,i,i+(1===e?-p:p),1===e),s.stroke(),ef&&(s.beginPath(),s.strokeStyle="white",s.lineWidth=30,s.arc(t,r,125,i,o,1===e),s.stroke())),s.globalAlpha=1,er&&null===f||requestAnimationFrame(eo)}}function el(){if(f){var t,a,o,p,h,d,m,g;if(f.x>=y.x&&f.x<=y.x+y.width&&f.y>=y.y&&f.y<=y.y+y.height||(t=f.x,a=f.y,o=y.x,p=y.y,h=y.x+y.width/2,d=y.y-80,m=y.x+y.width,.1>Math.abs(Math.abs((h-o)*((g=y.y)-p)-(m-o)*(d-p))/2-(Math.abs((o-t)*(d-a)-(h-t)*(p-a))/2+Math.abs((h-t)*(g-a)-(m-t)*(d-a))/2+Math.abs((m-t)*(p-a)-(o-t)*(g-a))/2)))){f=null,Q();return}let _=1===e?c:l,b=_.y+(_.height-_.hitboxHeight)/2,x=Math.max(_.x,Math.min(f.x,_.x+_.width)),v=Math.max(b,Math.min(f.y,b+_.hitboxHeight));if(10>=Math.sqrt((f.x-x)**2+(f.y-v)**2)){if(r(i,1),null!==_.hp&&_.hp<=0&&(_.hp=0,_.height=_.height/1.5,_.y=n.height-_.height-34),f=null,_===c?(M=!0,W=performance.now()):(O=!0,q=performance.now()),R=Date.now(),0!==_.hp||u)Q();else{er=!0,u=!0;let t=1===e?"Puppet":"Gizmo",a=1===e?2:1;if(O=!1,M=!1,!s)return;s.globalAlpha=1,cancelAnimationFrame(eo),function(e,t){console.log("Starting death animation for player",e);let a=0,r=0,i=1===e?w:k;if(0===i.length){console.error("No death animation frames loaded!"),t&&t();return}!function o(){if(a>=i.length){if(++r<6){a=0,requestAnimationFrame(()=>setTimeout(o,25));return}console.log("Animation complete after",6,"plays"),t&&t();return}(1===e?P:C).src=i[a].src,s&&(s.clearRect(0,0,n.width,n.height),Y(),V(l),V(c),Z(),a++,requestAnimationFrame(()=>setTimeout(o,25)))}()}(a,()=>{setTimeout(()=>{(function(e){er=!0;let t="Puppet"===e?"#E82C40":"#89DF6F",a=0,r=10,i=Date.now();ec=!0,function o(){let l=Math.min((Date.now()-i)/2e3,1),c=l<.5?2*l*l:-1+(4-2*l)*l;a=c,r=10+38*c,s&&(s.clearRect(0,0,n.width,n.height),s.fillStyle="rgba(".concat(parseInt(t.slice(1,3),16),", ").concat(parseInt(t.slice(3,5),16),", ").concat(parseInt(t.slice(5,7),16),", ").concat(a,")"),s.fillRect(0,0,n.width,n.height),s.fillStyle="rgba(255, 255, 255, ".concat(a,")"),s.font="".concat(r,"px Fortnite"),s.textAlign="center",s.textBaseline="middle",s.fillText("Game Over! ".concat(e," wins!"),n.width/2,n.height/2),ec&&(s.globalAlpha=a,s.drawImage(E,N.x,N.y,N.width,N.height),s.globalAlpha=1),l<1&&requestAnimationFrame(o))}()})(t)},0)})}}}}let ec=!1,ep=3,eh=["https://klanfontan.github.io/assets/gizmo_stars/frame_00.png","https://klanfontan.github.io/assets/gizmo_stars/frame_01.png","https://klanfontan.github.io/assets/gizmo_stars/frame_02.png","https://klanfontan.github.io/assets/gizmo_stars/frame_03.png","https://klanfontan.github.io/assets/gizmo_stars/frame_04.png","https://klanfontan.github.io/assets/gizmo_stars/frame_05.png","https://klanfontan.github.io/assets/gizmo_stars/frame_06.png","https://klanfontan.github.io/assets/gizmo_stars/frame_07.png","https://klanfontan.github.io/assets/gizmo_stars/frame_08.png","https://klanfontan.github.io/assets/gizmo_stars/frame_09.png","https://klanfontan.github.io/assets/gizmo_stars/frame_10.png"],ed=[],eu=0,em=0;Promise.all([new Promise(e=>v.onload=e),new Promise(e=>j.onload=e),new Promise(e=>P.onload=e),new Promise(e=>C.onload=e)]).then(()=>{(function(){let e=0,t=b.length+x.length;function a(){e++,console.log("Loaded ".concat(e,"/").concat(t," death frames"))}b.forEach(e=>{let t=new Image;t.onload=a,t.src=e,w.push(t)}),x.forEach(e=>{let t=new Image;t.onload=a,t.src=e,k.push(t)})})(),eh.forEach(e=>{let t=new Image;t.src=e,ed.push(t)}),U&&(U&&U.drawImage(v,0,0,n.width,n.height),ey(U),e_(U)),B(),function e(){s&&(s.clearRect(0,0,n.width,n.height),s.fillStyle="rgba(232, 44, 64, 1)",s.fillRect(0,0,n.width,n.height),s.fillStyle="white",s.font="100px Fortnite",s.textAlign="center",s.textBaseline="middle",s.fillText(ep.toString(),n.width/2,n.height/2),ep>1?(ep--,setTimeout(e,1e3)):setTimeout(()=>{ep=3,ei=!1,eo()},1e3))}()}),n.addEventListener("click",t=>{if(ec){let a=n.getBoundingClientRect(),s=t.clientX-a.left,r=t.clientY-a.top;s>=N.x&&s<=N.x+N.width&&r>=N.y&&r<=N.y+N.height&&(l.hp=l.maxHp,c.hp=c.maxHp,e=1,m=!0,f=null,_=0,er=!1,u=!1,eo(),ec=!1)}});let ef=!1;function eg(e,t){let a=n.getBoundingClientRect();return e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom}function e_(e){let t=n.width/2;e.drawImage(I,t-37.5,30,75,63)}function ey(e){let t=n.width/2+100-30,a=n.width/2-100-65;e.drawImage(A,t,10,100,100),e.drawImage(F,a,10,100,100)}n.addEventListener("touchstart",t=>{let a=t.changedTouches[0],s=a.clientX,r=a.clientY;if(ec&&(n.getBoundingClientRect(),s>=N.x&&s<=N.x+N.width&&r>=N.y&&r<=N.y+N.height)){window.location.href="../../../index.html";return}let i=!1;if(ex.forEach((e,t)=>{if(!e.used&&s>=e.x&&s<=e.x+e.width&&r>=e.y&&r<=e.y+e.height){i=!0;return}}),!i&&eg(s,r)){if(t.preventDefault(),1!==e)return;!m||f||1!==e||(ef=!0)}}),n.addEventListener("touchend",t=>{let a=t.changedTouches[0];if(eg(a.clientX,a.clientY)){if(t.preventDefault(),1!==e)return;ef&&(ef=!1,ea())}}),n.addEventListener("touchmove",e=>{e.preventDefault()}),new FontFace("Fortnite","url(https://klanfontan.github.io/game/Puppet-main/gamecode/frt.otf)").load().then(function(e){document.fonts.add(e),s&&(s.font="48px Fortnite")}).catch(function(e){console.error("Ошибка загрузки шрифта:",e)});let eb=new Image;eb.src="https://klanfontan.github.io/game/Puppet-main/gamecode/potion.png";let ex=[{x:65,y:35,width:50,height:70,used:!1},{x:n.width-115,y:35,width:50,height:70,used:!1}];n.addEventListener("click",e=>{e.preventDefault();let t=n.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top;ex.forEach((e,t)=>{!e.used&&a>=e.x&&a<=e.x+e.width&&s>=e.y&&(e.y,e.height)})});let ew=1},[]),(0,n.jsx)("canvas",{id:"gameCanvas",width:"1280",height:"522"})}i()(()=>a.e(959).then(a.bind(a,2959)),{loadableGenerated:{webpack:()=>[2959]},ssr:!1});var b=()=>{let{data:e,isLoading:t,isError:a}=(0,o.Ov)({blockIdentifier:"latest"}),{connect:r,connectors:i}=(0,o.$4)(),{disconnect:b}=(0,o.qL)(),[x,w]=(0,s.useState)(!0),[k,v]=(0,s.useState)(!1),[j,P]=(0,s.useState)(!1),[C,E]=(0,s.useState)(null),[N,I]=(0,s.useState)(!1),[A,F]=(0,s.useState)(0),[z,S]=(0,s.useState)(0),[T,O]=(0,s.useState)(!1),[M,R]=(0,s.useState)(),[L,B]=(0,s.useState)(!1),[D,G]=(0,s.useState)(null),[U,Y]=(0,s.useState)(null),X=async()=>{if(et&&q)try{"Puppet"===C?S(1):S(2),F(Math.floor(4294967296*Math.random())),await e_(z,A)&&B(!0)}catch(e){console.error("Error sending transaction:",e)}},H=async()=>{if(et&&q)try{if(await ek(A)!=q&&await ew(A)==q||await ew(A)!=q&&await ek(A)==q){B(!0);return}await ey(A)&&B(!0)}catch(e){console.error("Error sending transaction:",e)}},{address:q}=(0,o.mA)(),{account:W}=(0,o.mA)(),{isLoading:V,isError:Z,error:J,data:Q}=(0,o.KQ)({address:q,watch:!0}),K="0x0409f17fbe2145d007c6d18731fa9919e943a60230fe5c2647f702615a49e4f9",[$,ee]=(0,s.useState)(0),{contract:et}=(0,o.cq)({abi:c,address:K}),ea=(0,s.useMemo)(()=>{if(!q||!et)return console.error("Contract or userAddress is undefined"),console.log("Contract:",et),console.log("User Address:",q),[]},[et,q,$]),{send:en,data:es,isPending:er}=(0,o.pQ)({calls:ea}),{data:ei,status:eo,isLoading:el,isError:ec,error:ep}=(0,o.VS)({hash:null==es?void 0:es.transaction_hash,watch:!0}),eh=(0,s.useMemo)(()=>new l.Gf({nodeUrl:_.env.NEXT_PUBLIC_RPC_URL}),[]),[ed,eu]=(0,s.useState)([]),em=(0,s.useRef)(0),{data:ef}=(0,o.Ov)({refetchInterval:3e3}),eg=(0,s.useCallback)(async(e,t)=>{if(!(t<=em.current))try{let a=em.current+1,n=await eh.getEvents({address:e.address,from_block:{block_number:a},to_block:{block_number:t},chunk_size:500});n&&n.events&&eu(e=>[...e,...n.events]),em.current=t}catch(e){console.error("Error checking for events:",e)}},[eh]);(0,s.useEffect)(()=>{et&&ef&&eg(et,ef)},[et,ef,eg]),(0,s.useMemo)(()=>[...ed].reverse().slice(0,5),[ed]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{v(!0),setTimeout(()=>w(!1),1e3)},2e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{(async()=>{if(q&&A){let e=await ex(q),t=await ek(A),a=t?await ex(t):null;G(e),Y(a)}})()},[q,A]);let e_=(0,s.useCallback)(async(e,t)=>{if(!W)return!1;O(!0),R(void 0);try{let{transaction_hash:a}=await W.execute([{contractAddress:K,entrypoint:"create_game",calldata:[e,t]}]);return R(a),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[W]),ey=(0,s.useCallback)(async e=>{if(!W)return!1;O(!0),R(void 0);try{let{transaction_hash:t}=await W.execute([{contractAddress:K,entrypoint:"join_game",calldata:[e]}]);return R(t),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[W]),eb=(0,s.useCallback)(async(e,t)=>{if(!W)return!1;O(!0),R(void 0);try{let{transaction_hash:a}=await W.execute([{contractAddress:K,entrypoint:"throw",calldata:[e,t]}]);return R(a),!0}catch(e){return console.error(e),!1}finally{O(!1)}},[W]);(0,s.useCallback)(async e=>{if(!W)return null;O(!0),R(void 0);try{let t=await W.callContract({contractAddress:K,entrypoint:"game_winner",calldata:[e]});return console.log("Game winner:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling game_winner:",e),null}finally{O(!1)}},[W]);let ex=(0,s.useCallback)(async e=>{if(!W)return null;O(!0),R(void 0);try{let t=await W.callContract({contractAddress:K,entrypoint:"player_health",calldata:[e]});return console.log("Player health:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling player_health:",e),null}finally{O(!1)}},[W]),ew=(0,s.useCallback)(async e=>{if(!W)return null;O(!0),R(void 0);try{let t=await W.callContract({contractAddress:K,entrypoint:"get_first_player",calldata:[e]});return console.log("First player:",t),t[0]}catch(e){return console.error("Error calling get_first_player:",e),null}finally{O(!1)}},[W]),ek=(0,s.useCallback)(async e=>{if(!W)return null;O(!0),R(void 0);try{let t=await W.callContract({contractAddress:K,entrypoint:"get_second_player",calldata:[e]});return console.log("Second player:",t),t[0]}catch(e){return console.error("Error calling get_second_player:",e),null}finally{O(!1)}},[W]),ev=(0,s.useCallback)(async e=>{if(!W)return null;O(!0),R(void 0);try{let t=await W.callContract({contractAddress:K,entrypoint:"get_game_turn",calldata:[e]});return console.log("Game turn:",Number(t[0])),Number(t[0])}catch(e){return console.error("Error calling get_game_turn:",e),null}finally{O(!1)}},[W]);return(0,n.jsx)("div",{className:"game-screen ".concat("Puppet"===C?"puppet-bg":"Gizmo"===C?"gizmo-bg":""),style:{opacity:k?1:0},children:j?(0,n.jsx)("div",{className:"screen",children:N?(0,n.jsx)(n.Fragment,{children:L?(0,n.jsx)(y,{player1Hp:D,player2Hp:U,throwStone:eb,gameId:A,getGameTurn:ev,getFirstPlayer:ew,getSecondPlayer:ek,getPlayerHealth:ex,userAddress:null!=q?q:null}):(0,n.jsxs)(n.Fragment,{children:["Puppet"===C&&(0,n.jsxs)("div",{className:"puppet-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:u.src,alt:"Back",onClick:()=>I(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:m.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:X,children:"CREATE GAME"}),(0,n.jsxs)("div",{className:"game-id-input",children:[(0,n.jsx)("input",{className:"game-id-input-field",type:"number",value:A,onChange:e=>F(parseInt(e.target.value))}),(0,n.jsx)("button",{className:"join-button",onClick:H,children:"JOIN GAME"})]})]})]})]})]})]}),"Gizmo"===C&&(0,n.jsxs)("div",{className:"gizmo-page",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:u.src,alt:"Back",onClick:()=>I(!1)})}),(0,n.jsxs)("div",{className:"enemy-select-container",children:[(0,n.jsxs)("div",{className:"enemy-selector",children:[(0,n.jsx)("h4",{className:"player-text",id:"player-text",children:"Player"}),(0,n.jsx)("img",{src:f.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"player-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{className:"victims-container",children:[(0,n.jsx)("h2",{children:"SELECT YOUR ACTION"}),(0,n.jsxs)("div",{className:"victim-selector",children:[(0,n.jsx)("button",{className:"create-button",onClick:X,children:"CREATE GAME"}),(0,n.jsxs)("div",{className:"game-id-input",children:[(0,n.jsx)("input",{className:"game-id-input-field",type:"number",value:A,onChange:e=>F(parseInt(e.target.value))}),(0,n.jsx)("button",{className:"join-button",onClick:H,children:"JOIN GAME"})]})]})]})]})]})]})]})}):(0,n.jsxs)("div",{className:"character-select-screen",children:[(0,n.jsx)("div",{className:"rotate-message",children:"PLEASE TURN YOUR DEVICE INTO LANDSCAPE MODE."}),(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"back-button",children:(0,n.jsx)("img",{src:u.src,alt:"Back",onClick:()=>P(!1)})}),(0,n.jsxs)("div",{className:"character-select-container",children:[(0,n.jsxs)("div",{id:"puppet-selector",className:"character-selector",onClick:()=>{E("Puppet"),I(!0)},children:[(0,n.jsx)("img",{src:m.src,alt:"Puppet"}),(0,n.jsx)("h3",{children:"PUPPET"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]}),(0,n.jsxs)("div",{id:"gizmo-selector",className:"character-selector",onClick:()=>{E("Gizmo"),I(!0)},children:[(0,n.jsx)("img",{src:f.src,alt:"Gizmo"}),(0,n.jsx)("h3",{children:"GIZMO"}),(0,n.jsx)("p",{className:"character-description",children:"55 (67%)"})]})]}),(0,n.jsx)("div",{className:"select-container",children:(0,n.jsx)("img",{className:"select-svg",src:g.src,alt:"Select"})})]})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"character left-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Puppet"}),(0,n.jsx)("img",{src:p.src,className:"App-left-character",alt:"Left Character"})]}),(0,n.jsxs)("div",{className:"vs-container",children:[(0,n.jsx)("img",{src:d.src,className:"App-vs",alt:"VS"}),(0,n.jsxs)("div",{className:"play-button-container",children:[(0,n.jsx)("button",{className:"start-game-button-text",onClick:()=>{q?(alert("Wallet Address: ".concat(q)),P(!0)):alert("Please connect your wallet")},children:"START GAME"}),i.map((e,t)=>(0,n.jsx)("button",{className:"play-button",onClick:()=>r({connector:e}),children:q?"CONNECTED":"CONNECT"},t))]})]}),(0,n.jsxs)("div",{className:"character right-character",children:[(0,n.jsx)("div",{className:"character-name",children:"Gizmo"}),(0,n.jsx)("img",{src:h.src,className:"App-right-character",alt:"Right Character"})]})]})})}}},function(e){e.O(0,[541,652,412,274,936,744],function(){return e(e.s=8095)}),_N_E=e.O()}]);